{
  "objects": [
    {
      "failureAndRerunMode": "CASCADE",
      "resourceRole": "DataPipelineDefaultResourceRole",
      "role": "DataPipelineDefaultRole",
      "pipelineLogUri": "s3://treefort-dynamo-backups/etl/logs/",
      "scheduleType": "ONDEMAND",
      "name": "Default",
      "id": "Default",
      "myComment": "This object is used to set default configuration for objects in the pipeline"
    },
    {
      "name": "Invoke_Lambda_Activity",
      "id": "Invoke_Lambda_Activity",
      "runsOn": {
        "ref": "New_EC2Instance"
      },
      "myComment": "This object is a ShellCommandActivity. It is used to specify the command linux shell command that will be invoked. In this case, it invokes Lambda Function.",
      "type": "ShellCommandActivity",
      "command": "aws lambda  --region #{myRegion} invoke --function-name #{myLambdaFunction} outfile.txt"
    },
    {
      "resourceRole": "DataPipelineDefaultResourceRole",
      "role": "DataPipelineDefaultRole",
      "imageId": "#{myImageId}",
      "instanceType": "#{myInstanceType}",
      "name": "New_EC2Instance",
      "id": "New_EC2Instance",
      "type": "Ec2Resource",
      "region": "#{myRegion}",
      "myComment": "This object is used to create an Amazon EC2 Instance that activities in the pipeline can run on.",
      "terminateAfter": "1 Hour"
    }
  ],
  "parameters": [
    {
      "description": "Lambda Function name",
      "id": "myLambdaFunction",
      "myComment": "This Parameter specifies the Lambda function name.",
      "type": "String"
    },
    {
      "default": "ami-8fcee4e5",
      "description": "Image Id",
      "id": "myImageId",
      "myComment": "This Parameter specifies image id",
      "type": "String"
    },
    {
      "description": "S3 path for pipeline logs.",
      "id": "myS3LogsPath",
      "type": "AWS::S3::ObjectKey",
      "myComment": "This Parameter specifies the S3 logging path for the pipeline. It is used by the 'Default' object to set the 'pipelineLogUri' value. Using Parameters helps users avoid hard coding variables in pipeline definitions. Users can instead supply these parameters when calling 'aws datapipeline put-pipeline-definition' or 'aws datapipeline activate-pipeline-definition'."
    },
    {
      "default": "us-west-2",
      "description": "Region",
      "id": "myRegion",
      "myComment": "This Parameter specifies region",
      "type": "String"
    },
    {
      "default": "t2.micro",
      "description": "Instance Type",
      "id": "myInstanceType",
      "type": "String",
      "myComment": "This Parameter specifies instance type"
    }
  ],
  "values": {
    "myImageId": "ami-1e299d7e",
    "myS3LogsPath": "s3://treefort-dynamo-backups/etl/logs/",
    "myInstanceType": "t2.micro",
    "myLambdaFunction": "transform-etl-song-to-dev-song",
    "myRegion": "us-west-2"
  }
}
